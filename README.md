# Introduction
The focus of this project is to implement a demosaicing algorithm to convert Bayer images to full color. I am employing the linear least squares machine learning technique to achieve this.
I have implemented the demosaicing algorithm in two ways, one way where the missing color 
component is interpolated with all the information in the Bayer patch, which the other way is where 
the missing color component is interpolated with only the information of the same color within the 
Bayer patch. In either case, I have used the normal equations to find the 8 coefficient matrices. 
Additional features to develop were white balance and histogram equalization which will be 
discussed as well. 

TLDR:
Here are the images before and after Debayering.
<img width="582" height="595" alt="image" src="https://github.com/user-attachments/assets/2490ee54-aa32-4f30-9a5c-ac42e0bc2a55" />
<img width="665" height="589" alt="image" src="https://github.com/user-attachments/assets/d43aafa0-2385-4fbb-b113-31c2581bc6ea" />


# Methods
The training data set consists of 5 images shown in the Figure 1 below. <img width="507" height="547" alt="Oranges" src="https://github.com/user-attachments/assets/b6c9af56-64dd-445a-bcda-187b76bfd378" />
<img width="1185" height="724" alt="Flower" src="https://github.com/user-attachments/assets/cea55d28-7b71-4cb9-8085-03b31af54f85" />
<img width="1184" height="813" alt="Climber" src="https://github.com/user-attachments/assets/65f7445d-c3fa-4ad3-8b29-e7bffad6ecb5" />
<img width="750" height="609" alt="Trees" src="https://github.com/user-attachments/assets/18c7cb77-efbe-49d9-be61-f02695400bf2" />
<img width="510" height="288" alt="0900x4" src="https://github.com/user-attachments/assets/430212b1-72dd-4c70-aac0-7b279d4bf442" />


The coefficient matrices were generated using two different methods. The first method uses all the 
information in the bayer patch to interpolate the missing color. While the second method only takes 
the information from the colors that match the missing color in the patch i.e. if the missing color 
is green only the green information in the patch is used for interpolation.  
Before discussing the training method, let us take a look at the mathematical equation we are trying 
to solve.  

$$
\hat{Y} = A \theta
$$
                                                     
Here, A represents the Bayer patches and theta represents the coefficient matrix multiplied to it to 
find the missing colors. The estimated Y value shown above is the estimated missing colors. For 
the same coefficient matrix this equation can give all the missing colors given all the patches if A 
is a matrix consisting of all the patches in an image and Y is all the missing components of that 
color (green, red, or blue). The function to be minimized then is just: 

$$
\min_{\theta} \ \left( Y - A \theta \right)^2
$$

Further simplifying this equation by taking the derivative results in the coefficient matrix for that 
individual color as the normal equations: 

$$
\theta = \left( A^T A \right)^{-1} A^T Y
$$


This is the method that I have used to compute my coefficient matrices. In the first method, my A 
matrix remains unchanged for both missing color components. While in the second method, I 
create 2 A matrices each representing only the values of the missing colors.  

# Full Information Linear Regression
To train the coefficient matrices, each image in the training data set is converted to the 4 pattern 
types RGGB, GBRG, GRBG, and BGGR.  
For each pattern, the A matrix is generated by randomly collecting a set number of patches from 
each image. Concurrently, an array of the ground truth is generated from the original images 
corresponding to the center of each patch in A. This results in A containing an array of patches and 
the ground truth middle pixels of those patches.  
The ground truth middle pixels are then split into the corresponding missing colors as y1 and y2 
i.e. if the middle pixel Bayer color is green, the missing colors blue and red are returned as y1 and 
y2 respectively.  
Finally, we apply the normal equations using A and y1 to find the first coefficient matrix and using 
A and y2 to find the second coefficient matrix.  

# Color-Matched Information Linear Regression
This method does everything done in the first method except the A matrix is also split into two 
matrices A1 and A2, where all the entries are 0 except the entries related to their corresponding 
missing components. For example, if green is the first missing component A1 contains only the 
green values with the other values set to 0. 
